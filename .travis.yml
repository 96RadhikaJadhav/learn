

env:
  global:
    - TOOLS_DIR=$HOME/build_tools
    - GNAT_INSTALLER_PATH=$TOOLS_DIR/gnat-community-2018-20180528-x86_64-linux-bin
    - GNAT_PATH=$TOOLS_DIR/gnat-community-2018-x86_64-linux-bin

os:
  - linux

cache:
  yarn: true
  directories:
  - $HOME/build_tools
  - $HOME/.cache/pip

before_install:
 - sudo apt-get install -y graphviz
 - apt remove cmdtest
 - curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -
 - echo "deb https://dl.yarnpkg.com/debian/ stable main" | tee /etc/apt/sources.list.d/yarn.list
 - apt-get update && apt-get install yarn
 - yarn

install: ./travis_install.sh

jobs:
  include:
    - stage: "Sphinx tests"
      language: python
      python: 3.6
      script:
        - PATH=$GNAT_PATH/bin:$PATH make SPHINXOPTS="-W" tests
    - stage: "Frontend build"
      language: python
      node_js: 3.6
      script:
        - yarn run build
        - PATH=$GNAT_PATH/bin:$PATH make html

# TODO: insert test stages for backend
